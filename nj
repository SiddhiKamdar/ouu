export const getTravelById = async (
  travelId: string
): Promise<Travel> => {
  const response = await axiosInstance.get(`/api/travel/${travelId}`);
  return response.data;
};


import axiosInstance from "./axiosInstance";

export interface TravelDocument {
  id: number;
  documentUrl: string;
  uploadedDate: string;
}

export const getDocumentsByTravel = async (
  travelId: string
): Promise<TravelDocument[]> => {
  const response = await axiosInstance.get(
    `/api/travel-documents/${travelId}`
  );
  return response.data;
};

export const uploadDocument = async (
  travelId: string,
  file: File,
  uploadedById: number
): Promise<void> => {

  const formData = new FormData();
  formData.append("file", file);
  formData.append("travelId", travelId);
  formData.append("uploadedById", uploadedById.toString());
  formData.append("documentTypeId", "1"); // temporary

  await axiosInstance.post(
    "/api/travel-documents/upload",
    formData,
    {
      headers: { "Content-Type": "multipart/form-data" }
    }
  );
};


import React, { useEffect, useState } from "react";
import { useParams } from "react-router-dom";
import {
  getTravelById,
  type Travel
} from "../services/travelService";
import {
  getDocumentsByTravel,
  uploadDocument,
  type TravelDocument
} from "../services/documentService";

const TravelDetail: React.FC = () => {

  const { travelId } = useParams();
  const user = JSON.parse(localStorage.getItem("user") || "{}");

  const [travel, setTravel] = useState<Travel | null>(null);
  const [documents, setDocuments] = useState<TravelDocument[]>([]);
  const [selectedFile, setSelectedFile] = useState<File | null>(null);

  useEffect(() => {
    if (travelId) {
      loadTravel();
      loadDocuments();
    }
  }, []);

  const loadTravel = async () => {
    const data = await getTravelById(travelId!);
    setTravel(data);
  };

  const loadDocuments = async () => {
    const data = await getDocumentsByTravel(travelId!);
    setDocuments(data);
  };

  const handleUpload = async () => {
    if (!selectedFile) return;

    await uploadDocument(
      travelId!,
      selectedFile,
      user.employeeId
    );

    setSelectedFile(null);
    loadDocuments();
  };

  if (!travel) return <div>Loading...</div>;

  return (
    <div className="card p-4 shadow-sm">

      <h4>Travel Detail</h4>

      <p><strong>Destination:</strong> {travel.destination}</p>
      <p>
        <strong>Employees:</strong> {travel.employeeNames?.join(", ")}
      </p>
      <p>
        <strong>Departure:</strong>{" "}
        {new Date(travel.departDate).toLocaleDateString()}
      </p>
      <p>
        <strong>Return:</strong>{" "}
        {new Date(travel.returnDate).toLocaleDateString()}
      </p>

      <hr />

      <h5>Documents</h5>

      {documents.length === 0 && <p>No documents uploaded yet.</p>}

      <ul>
        {documents.map((doc) => (
          <li key={doc.id}>
            {doc.documentUrl.split("\\").pop()}
          </li>
        ))}
      </ul>

      <hr />

      <h5>Upload Document</h5>

      <input
        type="file"
        onChange={(e) =>
          setSelectedFile(e.target.files?.[0] || null)
        }
      />

      <button
        className="btn btn-primary mt-2"
        onClick={handleUpload}
      >
        Upload
      </button>

    </div>
  );
};

export default TravelDetail;


import React, { useEffect, useState } from "react";
import { Container, Row, Col, Card } from "react-bootstrap";
import { NavLink, useNavigate } from "react-router-dom";
import { getTravels, type Travel } from "../services/travelService";

const TravelDisplay: React.FC = () => {
  const navigate = useNavigate();
  const user = JSON.parse(localStorage.getItem("user") || "{}");

  const [travels, setTravels] = useState<Travel[]>([]);

  useEffect(() => {
    loadTravels();
  }, []);

  const loadTravels = async () => {
    const data = await getTravels();
    setTravels(data);
  };

  return (
    <Container fluid style={{ marginTop: "20px" }}>

      {user.role === "HR" && (
        <div className="d-flex justify-content-end mb-3">
          <button
            className="btn btn-success"
            onClick={() => navigate("/app/travel/create")}
          >
            + Create Travel
          </button>
        </div>
      )}

      <Row className="gy-4">
        {travels.map((travel) => (
          <Col key={travel.travelId} sm={12} md={6} lg={4}>
            <Card className="shadow-sm h-100">

              <Card.Body>
                <Card.Title className="mb-3">
                  Travel #{travel.travelId}
                </Card.Title>

                <Card.Text>
                  <strong>Employees:</strong>{" "}
                  {travel.employeeNames?.join(", ")}
                </Card.Text>

                <Card.Text>
                  <strong>Destination:</strong> {travel.destination}
                </Card.Text>

                <Card.Text>
                  <strong>Departure:</strong>{" "}
                  {new Date(travel.departDate).toLocaleDateString()}
                </Card.Text>

                <Card.Text>
                  <strong>Return:</strong>{" "}
                  {new Date(travel.returnDate).toLocaleDateString()}
                </Card.Text>
              </Card.Body>

              <Card.Footer className="bg-white text-center">
                <NavLink
                  to={`/app/travel/${travel.travelId}`}
                  className="text-success fw-semibold text-decoration-none"
                >
                  View Details â†’
                </NavLink>
              </Card.Footer>

            </Card>
          </Col>
        ))}
      </Row>
    </Container>
  );
};

export default TravelDisplay;


