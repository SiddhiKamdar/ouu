CREATE TABLE notifications(
    notification_id INT IDENTITY PRIMARY KEY,
    employee_id INT NOT NULL,
    title VARCHAR(200),
    message VARCHAR(500),
    is_read BIT DEFAULT 0,
    created_at DATETIME DEFAULT GETDATE()
);

package com.example.backend.entity;

import jakarta.persistence.*;
import java.util.Date;

@Entity
@Table(name="notifications")
public class Notification {

    @Id
    @GeneratedValue(strategy=GenerationType.IDENTITY)
    private Integer notificationId;

    @ManyToOne
    @JoinColumn(name="employee_id")
    private Employee employee;

    private String title;
    private String message;

    @Column(name="is_read")
    private Boolean isRead=false;

    @Temporal(TemporalType.TIMESTAMP)
    private Date createdAt=new Date();

    public Integer getNotificationId(){return notificationId;}
    public Employee getEmployee(){return employee;}
    public void setEmployee(Employee employee){this.employee=employee;}
    public String getTitle(){return title;}
    public void setTitle(String title){this.title=title;}
    public String getMessage(){return message;}
    public void setMessage(String message){this.message=message;}
    public Boolean getIsRead(){return isRead;}
    public void setIsRead(Boolean read){isRead=read;}
}


package com.example.backend.repository;

import com.example.backend.entity.Notification;
import org.springframework.data.jpa.repository.JpaRepository;
import java.util.List;

public interface NotificationRepository
        extends JpaRepository<Notification,Integer>{

    List<Notification>
    findByEmployeeEmployeeIdOrderByCreatedAtDesc(
            Integer employeeId);
}


package com.example.backend.service;

import com.example.backend.entity.*;
import com.example.backend.repository.*;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class NotificationService {

    @Autowired
    private NotificationRepository notificationRepo;

    public void create(
            Employee employee,
            String title,
            String message){

        Notification n=new Notification();
        n.setEmployee(employee);
        n.setTitle(title);
        n.setMessage(message);

        notificationRepo.save(n);
    }

    public List<Notification>
    getMyNotifications(Integer empId){

        return notificationRepo
                .findByEmployeeEmployeeIdOrderByCreatedAtDesc(empId);
    }
}


package com.example.backend.controller;

import com.example.backend.entity.Notification;
import com.example.backend.service.NotificationService;
import com.example.backend.service.ExpenseService;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/notifications")
public class NotificationController {

    @Autowired
    private NotificationService notificationService;

    @Autowired
    private ExpenseService expenseService;

    @GetMapping("/my")
    public List<Notification> myNotifications(){

        return notificationService
                .getMyNotifications(
                        expenseService
                        .getLoggedInEmployee()
                        .getEmployeeId());
    }
}

notificationService.create(
        hr,
        "New Expense Submitted",
        employee.getFullName()
        +" submitted expense");

notificationService.create(
        expenseOwner,
        "Expense Updated",
        "Your expense is "+statusName);



package com.example.backend.service;

import com.example.backend.entity.Employee;
import com.example.backend.repository.EmployeeRepository;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Service;

@Service
public class LoggedInUserService {

    @Autowired
    private EmployeeRepository employeeRepository;

    public Employee getLoggedInEmployee(){

        String email =
                SecurityContextHolder
                        .getContext()
                        .getAuthentication()
                        .getName();

        return employeeRepository
                .findByEmail(email)
                .orElseThrow();
    }
}



