package com.example.backend.repository;

import com.example.backend.entity.ApprovalStatus;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface ApprovalStatusRepository
        extends JpaRepository<ApprovalStatus, Integer> {
}

package com.example.backend.entity;

import jakarta.persistence.*;

@Entity
@Table(name = "approval_statuses")
public class ApprovalStatus {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "approval_status_id")
    private Integer approvalStatusId;

    @Column(name = "approval_status_name")
    private String approvalStatusName;

    public Integer getApprovalStatusId() {
        return approvalStatusId;
    }

    public void setApprovalStatusId(Integer approvalStatusId) {
        this.approvalStatusId = approvalStatusId;
    }

    public String getApprovalStatusName() {
        return approvalStatusName;
    }

    public void setApprovalStatusName(String approvalStatusName) {
        this.approvalStatusName = approvalStatusName;
    }
}


@RestController
@RequestMapping("/api/expenses")
public class ExpenseController {

    @Autowired
    private ExpenseService expenseService;


    @PostMapping
    @PreAuthorize("hasRole('EMPLOYEE')")
    public ResponseEntity<?> create(
            @RequestParam Integer travelId,
            @RequestParam Integer employeeId,
            @RequestParam Integer expenseTypeId,
            @RequestParam BigDecimal amount,
            @RequestParam String proofUrl,
            @RequestParam(required=false)
            String comment){

        return ResponseEntity.ok(
                expenseService.createExpense(
                        travelId,
                        employeeId,
                        expenseTypeId,
                        amount,
                        comment,
                        proofUrl,
                        new Date()
                ));
    }


    @PutMapping("/{id}/approve")
    @PreAuthorize("hasRole('HR')")
    public void approve(
            @PathVariable Integer id,
            @RequestParam Integer hrId){

        expenseService.approveExpense(id,hrId);
    }


    @PutMapping("/{id}/reject")
    @PreAuthorize("hasRole('HR')")
    public void reject(
            @PathVariable Integer id,
            @RequestParam Integer hrId,
            @RequestParam String remark){

        expenseService.rejectExpense(id,hrId,remark);
    }
}

