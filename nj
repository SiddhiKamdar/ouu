package com.example.backend.dto.request;

import java.util.Date;

public class TravelRequestDTO {

    private Long employeeId;
    private String destination;
    private Date departDate;
    private Date returnDate;

    public Long getEmployeeId() {
        return employeeId;
    }

    public void setEmployeeId(Long employeeId) {
        this.employeeId = employeeId;
    }

    public String getDestination() {
        return destination;
    }

    public void setDestination(String destination) {
        this.destination = destination;
    }

    public Date getDepartDate() {
        return departDate;
    }

    public void setDepartDate(Date departDate) {
        this.departDate = departDate;
    }

    public Date getReturnDate() {
        return returnDate;
    }

    public void setReturnDate(Date returnDate) {
        this.returnDate = returnDate;
    }
}

package com.example.backend.repository;

import com.example.backend.entity.Employee;
import org.springframework.data.jpa.repository.JpaRepository;

public interface EmployeeRepository extends JpaRepository<Employee, Long> {
}


package com.example.backend.service;

import com.example.backend.dto.request.TravelRequestDTO;
import com.example.backend.dto.response.TravelResponseDTO;
import com.example.backend.entity.Employee;
import com.example.backend.entity.Travel;
import com.example.backend.repository.EmployeeRepository;
import com.example.backend.repository.TravelModuleRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class TravelModuleService {

    @Autowired
    private TravelModuleRepository travelRepository;

    @Autowired
    private EmployeeRepository employeeRepository;

    // âœ… GET ALL
    public List<TravelResponseDTO> getAllTravels() {

        return travelRepository.findAll()
                .stream()
                .map(this::mapToDTO)
                .toList();
    }

    // âœ… GET BY ID
    public TravelResponseDTO getTravelById(Long id) {

        Travel travel = travelRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Travel not found"));

        return mapToDTO(travel);
    }

    // âœ… CREATE
    public TravelResponseDTO createTravel(TravelRequestDTO request) {

        Employee employee = employeeRepository.findById(request.getEmployeeId())
                .orElseThrow(() -> new RuntimeException("Employee not found"));

        Travel travel = new Travel();
        travel.setEmployee(employee);
        travel.setDestination(request.getDestination());
        travel.setDepartDate(request.getDepartDate());
        travel.setReturnDate(request.getReturnDate());

        Travel saved = travelRepository.save(travel);

        return mapToDTO(saved);
    }

    // âœ… UPDATE
    public TravelResponseDTO updateTravel(Long id, TravelRequestDTO request) {

        Travel travel = travelRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Travel not found"));

        Employee employee = employeeRepository.findById(request.getEmployeeId())
                .orElseThrow(() -> new RuntimeException("Employee not found"));

        travel.setEmployee(employee);
        travel.setDestination(request.getDestination());
        travel.setDepartDate(request.getDepartDate());
        travel.setReturnDate(request.getReturnDate());

        Travel updated = travelRepository.save(travel);

        return mapToDTO(updated);
    }

    // âœ… DELETE
    public void deleteTravel(Long id) {

        Travel travel = travelRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Travel not found"));

        travelRepository.delete(travel);
    }

    // ðŸ”¥ Mapping Method
    private TravelResponseDTO mapToDTO(Travel travel) {
        return new TravelResponseDTO(
                travel.getTravelId(),
                travel.getEmployee().getFullName(),
                travel.getDestination(),
                travel.getDepartDate(),
                travel.getReturnDate()
        );
    }
}

package com.example.backend.controller;

import com.example.backend.dto.request.TravelRequestDTO;
import com.example.backend.dto.response.TravelResponseDTO;
import com.example.backend.service.TravelModuleService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/travel")
public class TravelModuleController {

    @Autowired
    private TravelModuleService travelModuleService;

    // âœ… GET ALL
    @GetMapping
    public ResponseEntity<List<TravelResponseDTO>> getAllTravels() {
        return ResponseEntity.ok(travelModuleService.getAllTravels());
    }

    // âœ… GET BY ID
    @GetMapping("/{id}")
    public ResponseEntity<TravelResponseDTO> getTravelById(@PathVariable Long id) {
        return ResponseEntity.ok(travelModuleService.getTravelById(id));
    }

    // âœ… CREATE
    @PostMapping
    public ResponseEntity<TravelResponseDTO> createTravel(@RequestBody TravelRequestDTO request) {
        return ResponseEntity.ok(travelModuleService.createTravel(request));
    }

    // âœ… UPDATE
    @PutMapping("/{id}")
    public ResponseEntity<TravelResponseDTO> updateTravel(
            @PathVariable Long id,
            @RequestBody TravelRequestDTO request) {
        return ResponseEntity.ok(travelModuleService.updateTravel(id, request));
    }

    // âœ… DELETE
    @DeleteMapping("/{id}")
    public ResponseEntity<String> deleteTravel(@PathVariable Long id) {
        travelModuleService.deleteTravel(id);
        return ResponseEntity.ok("Travel deleted successfully");
    }
}

