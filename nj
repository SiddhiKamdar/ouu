List<TravelDocument> findByTravel_TravelId(int travelId);

List<TravelDocument> findByTravel_TravelIdAndEmployee_EmployeeId(
        int travelId, int employeeId
);

List<TravelDocument> findByTravel_TravelIdAndEmployeeIsNull(int travelId);


@PreAuthorize("hasAnyRole('HR','MANAGER','EMPLOYEE')")
@GetMapping("/{travelId}")
public ResponseEntity<List<TravelDocument>> getDocuments(
        @PathVariable int travelId) {

    return ResponseEntity.ok(
            travelDocumentService.getDocumentsByTravel(travelId)
    );
}


import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.Authentication;

public List<TravelDocument> getDocumentsByTravel(int travelId) {

    Authentication authentication =
            SecurityContextHolder.getContext().getAuthentication();

    String email = authentication.getName();
    String role = authentication.getAuthorities()
            .iterator()
            .next()
            .getAuthority();

    Employee loggedInUser = employeeRepository
            .findByEmail(email)
            .orElseThrow(() -> new RuntimeException("User not found"));

    if (role.equals("ROLE_HR")) {
        return travelDocumentRepository
                .findByTravel_TravelId(travelId);
    }

    if (role.equals("ROLE_MANAGER")) {

        List<Employee> teamMembers =
                employeeRepository.findBySupervisor(loggedInUser);

        List<Integer> teamIds = teamMembers
                .stream()
                .map(Employee::getEmployeeId)
                .toList();

        return travelDocumentRepository
                .findByTravel_TravelId(travelId)
                .stream()
                .filter(doc -> {

                    if (doc.getEmployee() == null) {
                        return true; // general doc
                    }

                    return teamIds.contains(
                            doc.getEmployee().getEmployeeId()
                    );
                })
                .toList();
    }

    return travelDocumentRepository
            .findByTravel_TravelId(travelId)
            .stream()
            .filter(doc -> {

                if (doc.getEmployee() == null) {
                    return true;
                }

                return doc.getEmployee()
                        .getEmployeeId()
                        == loggedInUser.getEmployeeId();
            })
            .toList();
}
